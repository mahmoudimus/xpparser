<tests>

  <test>
    <query>foo/bar</query>
    <validation schema="xpath-1.0-core-orig.rnc" valid="yes"/>
    <validation schema="data-xpath.rnc" valid="yes"/>
  </test>

  <test>
    <query>foo/@a = bar/@b</query>
    <validation schema="xpath-1.0-core-orig.rnc" valid="no"/>
    <validation schema="data-xpath.rnc" valid="yes"/>
  </test>

  <test>
    <query>/foo/bar</query>
    <validation schema="xpath-1.0-core-orig.rnc" valid="no"/>
    <validation schema="xpath-1.0-core-basic.rnc" valid="yes"/>
  </test>

  <!-- navigation -->

  <test>
    <query>child::*</query>
    <validation schema="xpath-1.0-core-orig.rnc" valid="yes"/>
    <validation schema="xpath-1.0-core-basic.rnc" valid="yes"/>
    <validation schema="xpath-1.0-core-last.rnc" valid="yes"/>
    <validation schema="xpath-1.0-core-full.rnc" valid="yes"/>
    <validation schema="data-xpath.rnc" valid="yes"/>
    <validation schema="xpath-1.0-downward-last.rnc" valid="yes"/>
    <validation schema="xpath-1.0-downward-basic.rnc" valid="yes"/>
    <validation schema="xpath-1.0-downward-orig.rnc" valid="yes"/>
    <validation schema="xpath-1.0-forward-last.rnc" valid="yes"/>
    <validation schema="xpath-1.0-forward-orig.rnc" valid="yes"/>
    <validation schema="xpath-1.0-forward-last.rnc" valid="yes"/>
    <validation schema="xpath-1.0.rnc" valid="yes"/>
    <validation schema="xpath-1.0-vertical-last.rnc" valid="yes"/>
    <validation schema="xpath-1.0-vertical-orig.rnc" valid="yes"/>
    <validation schema="xpath-1.0-vertical-full.rnc" valid="yes"/>
    <validation schema="xpath-2.0-core-orig.rnc" valid="yes"/>
    <validation schema="xpath-2.0-core-join.rnc" valid="yes"/>
    <validation schema="xpath-2.0.rnc" valid="yes"/>
    <validation schema="xpath-3.0.rnc" valid="yes"/>
    <validation schema="xpath-non-mixing-orig.rnc" valid="yes"/>
    <validation schema="xpath-non-mixing-basic.rnc" valid="yes"/>
  </test>

  <test>
    <query>descendant::*</query>
    <validation schema="xpath-1.0-core-last.rnc" valid="yes"/>
    <validation schema="xpath-1.0-core-orig.rnc" valid="yes"/>
    <validation schema="xpath-1.0-core-full.rnc" valid="yes"/>
    <validation schema="data-xpath.rnc" valid="yes"/>
    <validation schema="xpath-1.0-downward-last.rnc" valid="yes"/>
    <validation schema="xpath-1.0-downward-orig.rnc" valid="yes"/>
    <validation schema="xpath-1.0-downward-last.rnc" valid="yes"/>
    <validation schema="xpath-1.0-forward-last.rnc" valid="yes"/>
    <validation schema="xpath-1.0-forward-orig.rnc" valid="yes"/>
    <validation schema="xpath-1.0-forward-last.rnc" valid="yes"/>
    <validation schema="xpath-1.0.rnc" valid="yes"/>
    <validation schema="xpath-1.0-vertical-last.rnc" valid="yes"/>
    <validation schema="xpath-1.0-vertical-orig.rnc" valid="yes"/>
    <validation schema="xpath-1.0-vertical-full.rnc" valid="yes"/>
    <validation schema="xpath-2.0-core-orig.rnc" valid="yes"/>
    <validation schema="xpath-2.0-core-join.rnc" valid="yes"/>
    <validation schema="xpath-2.0.rnc" valid="yes"/>
    <validation schema="xpath-3.0.rnc" valid="yes"/>
    <validation schema="xpath-non-mixing-orig.rnc" valid="yes"/>
    <validation schema="xpath-non-mixing-basic.rnc" valid="yes"/>
  </test>

  <test>
    <query>parent::*</query>
    <validation schema="xpath-1.0-core-last.rnc" valid="yes"/>
    <validation schema="xpath-1.0-core-orig.rnc" valid="yes"/>
    <validation schema="xpath-1.0-core-full.rnc" valid="yes"/>
    <validation schema="data-xpath.rnc" valid="yes"/>
    <validation schema="xpath-1.0-downward-last.rnc" valid="no"/>
    <validation schema="xpath-1.0-downward-orig.rnc" valid="no"/>
    <validation schema="xpath-1.0-downward-last.rnc" valid="no"/>
    <validation schema="xpath-1.0-forward-last.rnc" valid="no"/>
    <validation schema="xpath-1.0-forward-orig.rnc" valid="no"/>
    <validation schema="xpath-1.0-forward-last.rnc" valid="no"/>
    <validation schema="xpath-1.0.rnc" valid="yes"/>
    <validation schema="xpath-1.0-vertical-last.rnc" valid="yes"/>
    <validation schema="xpath-1.0-vertical-orig.rnc" valid="yes"/>
    <validation schema="xpath-1.0-vertical-full.rnc" valid="yes"/>
    <validation schema="xpath-2.0-core-orig.rnc" valid="yes"/>
    <validation schema="xpath-2.0-core-join.rnc" valid="yes"/>
    <validation schema="xpath-2.0.rnc" valid="yes"/>
    <validation schema="xpath-3.0.rnc" valid="yes"/>
    <validation schema="xpath-non-mixing-orig.rnc" valid="yes"/>
    <validation schema="xpath-non-mixing-basic.rnc" valid="yes"/>
  </test>

  <test>
    <query>ancestor::*</query>
    <validation schema="xpath-1.0-core-last.rnc" valid="yes"/>
    <validation schema="xpath-1.0-core-orig.rnc" valid="yes"/>
    <validation schema="xpath-1.0-core-full.rnc" valid="yes"/>
    <validation schema="data-xpath.rnc" valid="yes"/>
    <validation schema="xpath-1.0-downward-last.rnc" valid="no"/>
    <validation schema="xpath-1.0-downward-orig.rnc" valid="no"/>
    <validation schema="xpath-1.0-downward-last.rnc" valid="no"/>
    <validation schema="xpath-1.0-forward-last.rnc" valid="no"/>
    <validation schema="xpath-1.0-forward-orig.rnc" valid="no"/>
    <validation schema="xpath-1.0-forward-last.rnc" valid="no"/>
    <validation schema="xpath-1.0.rnc" valid="yes"/>
    <validation schema="xpath-1.0-vertical-last.rnc" valid="yes"/>
    <validation schema="xpath-1.0-vertical-orig.rnc" valid="yes"/>
    <validation schema="xpath-1.0-vertical-full.rnc" valid="yes"/>
    <validation schema="xpath-2.0-core-orig.rnc" valid="yes"/>
    <validation schema="xpath-2.0-core-join.rnc" valid="yes"/>
    <validation schema="xpath-2.0.rnc" valid="yes"/>
    <validation schema="xpath-3.0.rnc" valid="yes"/>
    <validation schema="xpath-non-mixing-orig.rnc" valid="yes"/>
    <validation schema="xpath-non-mixing-basic.rnc" valid="yes"/>
  </test>

  <test>
    <query>following-sibling::*</query>
    <validation schema="xpath-1.0-core-last.rnc" valid="yes"/>
    <validation schema="xpath-1.0-core-orig.rnc" valid="yes"/>
    <validation schema="xpath-1.0-core-full.rnc" valid="yes"/>
    <validation schema="data-xpath.rnc" valid="yes"/>
    <validation schema="xpath-1.0-downward-last.rnc" valid="no"/>
    <validation schema="xpath-1.0-downward-orig.rnc" valid="no"/>
    <validation schema="xpath-1.0-downward-last.rnc" valid="no"/>
    <validation schema="xpath-1.0-forward-last.rnc" valid="yes"/>
    <validation schema="xpath-1.0-forward-orig.rnc" valid="yes"/>
    <validation schema="xpath-1.0-forward-last.rnc" valid="yes"/>
    <validation schema="xpath-1.0.rnc" valid="yes"/>
    <validation schema="xpath-1.0-vertical-last.rnc" valid="no"/>
    <validation schema="xpath-1.0-vertical-orig.rnc" valid="no"/>
    <validation schema="xpath-1.0-vertical-full.rnc" valid="no"/>
    <validation schema="xpath-2.0-core-orig.rnc" valid="yes"/>
    <validation schema="xpath-2.0-core-join.rnc" valid="yes"/>
    <validation schema="xpath-2.0.rnc" valid="yes"/>
    <validation schema="xpath-3.0.rnc" valid="yes"/>
    <validation schema="xpath-non-mixing-orig.rnc" valid="yes"/>
    <validation schema="xpath-non-mixing-basic.rnc" valid="yes"/>
  </test>

  <test>
    <query>preceding-sibling::*</query>
    <validation schema="xpath-1.0-core-last.rnc" valid="yes"/>
    <validation schema="xpath-1.0-core-orig.rnc" valid="yes"/>
    <validation schema="xpath-1.0-core-full.rnc" valid="yes"/>
    <validation schema="data-xpath.rnc" valid="yes"/>
    <validation schema="xpath-1.0-downward-last.rnc" valid="no"/>
    <validation schema="xpath-1.0-downward-orig.rnc" valid="no"/>
    <validation schema="xpath-1.0-downward-last.rnc" valid="no"/>
    <validation schema="xpath-1.0-forward-last.rnc" valid="no"/>
    <validation schema="xpath-1.0-forward-orig.rnc" valid="no"/>
    <validation schema="xpath-1.0-forward-last.rnc" valid="no"/>
    <validation schema="xpath-1.0.rnc" valid="yes"/>
    <validation schema="xpath-1.0-vertical-last.rnc" valid="no"/>
    <validation schema="xpath-1.0-vertical-orig.rnc" valid="no"/>
    <validation schema="xpath-1.0-vertical-full.rnc" valid="no"/>
    <validation schema="xpath-2.0-core-orig.rnc" valid="yes"/>
    <validation schema="xpath-2.0-core-join.rnc" valid="yes"/>
    <validation schema="xpath-2.0.rnc" valid="yes"/>
    <validation schema="xpath-3.0.rnc" valid="yes"/>
    <validation schema="xpath-non-mixing-orig.rnc" valid="yes"/>
    <validation schema="xpath-non-mixing-basic.rnc" valid="yes"/>
  </test>

  <test>
    <query>following::*</query>
    <validation schema="xpath-1.0-core-last.rnc" valid="yes"/>
    <validation schema="xpath-1.0-core-orig.rnc" valid="yes"/>
    <validation schema="xpath-1.0-core-full.rnc" valid="yes"/>
    <validation schema="data-xpath.rnc" valid="yes"/>
    <validation schema="xpath-1.0-downward-last.rnc" valid="no"/>
    <validation schema="xpath-1.0-downward-orig.rnc" valid="no"/>
    <validation schema="xpath-1.0-downward-last.rnc" valid="no"/>
    <validation schema="xpath-1.0-forward-last.rnc" valid="no"/>
    <validation schema="xpath-1.0-forward-orig.rnc" valid="no"/>
    <validation schema="xpath-1.0-forward-last.rnc" valid="no"/>
    <validation schema="xpath-1.0.rnc" valid="yes"/>
    <validation schema="xpath-1.0-vertical-last.rnc" valid="no"/>
    <validation schema="xpath-1.0-vertical-orig.rnc" valid="no"/>
    <validation schema="xpath-1.0-vertical-full.rnc" valid="no"/>
    <validation schema="xpath-2.0-core-orig.rnc" valid="yes"/>
    <validation schema="xpath-2.0-core-join.rnc" valid="yes"/>
    <validation schema="xpath-2.0.rnc" valid="yes"/>
    <validation schema="xpath-3.0.rnc" valid="yes"/>
    <validation schema="xpath-non-mixing-orig.rnc" valid="yes"/>
    <validation schema="xpath-non-mixing-basic.rnc" valid="yes"/>
  </test>

  <test>
    <query>preceding::*</query>
    <validation schema="xpath-1.0-core-last.rnc" valid="yes"/>
    <validation schema="xpath-1.0-core-orig.rnc" valid="yes"/>
    <validation schema="xpath-1.0-core-full.rnc" valid="yes"/>
    <validation schema="data-xpath.rnc" valid="yes"/>
    <validation schema="xpath-1.0-downward-last.rnc" valid="no"/>
    <validation schema="xpath-1.0-downward-orig.rnc" valid="no"/>
    <validation schema="xpath-1.0-downward-last.rnc" valid="no"/>
    <validation schema="xpath-1.0-forward-last.rnc" valid="no"/>
    <validation schema="xpath-1.0-forward-orig.rnc" valid="no"/>
    <validation schema="xpath-1.0-forward-last.rnc" valid="no"/>
    <validation schema="xpath-1.0.rnc" valid="yes"/>
    <validation schema="xpath-1.0-vertical-last.rnc" valid="no"/>
    <validation schema="xpath-1.0-vertical-orig.rnc" valid="no"/>
    <validation schema="xpath-1.0-vertical-full.rnc" valid="no"/>
    <validation schema="xpath-2.0-core-orig.rnc" valid="yes"/>
    <validation schema="xpath-2.0-core-join.rnc" valid="yes"/>
    <validation schema="xpath-2.0.rnc" valid="yes"/>
    <validation schema="xpath-3.0.rnc" valid="yes"/>
    <validation schema="xpath-non-mixing-orig.rnc" valid="yes"/>
    <validation schema="xpath-non-mixing-basic.rnc" valid="yes"/>
  </test>

  <!-- root() -->

  <test>
    <query>//a/root()/b</query>

    <validation schema="xpath-1.0-forward-last.rnc" valid="no"/>
    <validation schema="xpath-1.0-downward-last.rnc" valid="no"/>
    <validation schema="xpath-1.0-vertical-full.rnc" valid="yes"/>
    <validation schema="xpath-non-mixing-basic.rnc" valid="yes"/>

    <validation schema="xpath-1.0-forward-basic.rnc" valid="no"/>
    <validation schema="xpath-1.0-downward-basic.rnc" valid="no"/>
    <validation schema="xpath-1.0-vertical-basic.rnc" valid="yes"/>
    <validation schema="xpath-non-mixing-basic.rnc" valid="yes"/>
  </test>

  <test>
    <query>/a</query>

    <validation schema="xpath-1.0-core-basic.rnc" valid="yes"/>
    <validation schema="xpath-1.0-core-orig.rnc" valid="no"/>

    <validation schema="xpath-2.0-core-basic.rnc" valid="yes"/>
    <validation schema="xpath-2.0-core-orig.rnc" valid="no"/>

    <validation schema="xpath-1.0-vertical-basic.rnc" valid="yes"/>
    <validation schema="xpath-1.0-vertical-orig.rnc" valid="no"/>

    <validation schema="xpath-1.0-downward-basic.rnc" valid="yes"/>
    <validation schema="xpath-1.0-downward-orig.rnc" valid="no"/>

    <validation schema="xpath-1.0-forward-basic.rnc" valid="yes"/>
    <validation schema="xpath-1.0-forward-orig.rnc" valid="no"/>

    <validation schema="xpath-emso2-basic.rnc" valid="yes"/>
    <validation schema="xpath-emso2-orig.rnc" valid="no"/>

    <validation schema="xpath-non-mixing-basic.rnc" valid="yes"/>
    <validation schema="xpath-non-mixing-orig.rnc" valid="yes"/> <!-- ??? -->

    <validation schema="data-xpath.rnc" valid="no" />

    <validation schema="xpath-1.0.rnc" valid="yes"/>
    <validation schema="xpath-2.0.rnc" valid="yes"/>
    <validation schema="xpath-3.0.rnc" valid="yes"/>
  </test>

  <test>
    <query>b//a</query>

    <validation schema="xpath-1.0-core-basic.rnc" valid="yes"/>
    <validation schema="xpath-1.0-core-orig.rnc" valid="no"/>

    <validation schema="xpath-2.0-core-basic.rnc" valid="yes"/>
    <validation schema="xpath-2.0-core-orig.rnc" valid="no"/>

    <validation schema="xpath-1.0-vertical-basic.rnc" valid="yes"/>
    <validation schema="xpath-1.0-vertical-orig.rnc" valid="no"/>

    <validation schema="xpath-1.0-downward-basic.rnc" valid="no"/>
    <validation schema="xpath-1.0-downward-orig.rnc" valid="no"/>

    <validation schema="xpath-1.0-forward-basic.rnc" valid="no"/>
    <validation schema="xpath-1.0-forward-orig.rnc" valid="no"/>

    <validation schema="xpath-emso2-basic.rnc" valid="yes"/>
    <validation schema="xpath-emso2-orig.rnc" valid="no"/>

    <validation schema="xpath-non-mixing-basic.rnc" valid="yes"/>
    <validation schema="xpath-non-mixing-orig.rnc" valid="yes"/> <!-- ??? -->

    <validation schema="xpath-1.0.rnc" valid="yes"/>
    <validation schema="xpath-2.0.rnc" valid="yes"/>
    <validation schema="xpath-3.0.rnc" valid="yes"/>
  </test>

  <!-- last() -->

  <!-- Abstract syntax trees may vary surprisingly
       depending on parenthesizing.
       Checking basic last() uses, with varying
       parenthesizing, for one and two axes.
       Fragments xpath-1.0-{core,data,vertical,downward}
       should agree on those queries. The downward fragment
       should behave similarly but should be tested with
       other axes since it can express last over descendant,
       thanks to regular xpath, child and following-sibling. -->
  <test>
    <query>descendant::a[last()]</query>
    <validation schema="xpath-1.0-core-orig.rnc" valid="no"/>
    <validation schema="xpath-1.0-core-basic.rnc" valid="no"/>
    <validation schema="data-xpath.rnc" valid="no"/>
    <validation schema="xpath-1.0-vertical-basic.rnc" valid="no"/>
    <validation schema="xpath-1.0-downward-basic.rnc" valid="no"/>
  </test>
  <test>
    <query>(descendant::a)[last()]</query>
    <validation schema="xpath-1.0-core-orig.rnc" valid="no"/>
    <validation schema="xpath-1.0-core-basic.rnc" valid="no"/>
    <validation schema="data-xpath.rnc" valid="no"/>
    <validation schema="xpath-1.0-vertical-basic.rnc" valid="no"/>
    <validation schema="xpath-1.0-downward-basic.rnc" valid="no"/>
  </test>
  <test>
    <query>self::b[last()]</query>
    <validation schema="xpath-1.0-core-orig.rnc" valid="no"/>
    <validation schema="xpath-1.0-core-basic.rnc" valid="no"/>
    <validation schema="data-xpath.rnc" valid="no"/>
    <validation schema="xpath-1.0-vertical-basic.rnc" valid="no"/>
    <validation schema="xpath-1.0-downward-basic.rnc" valid="no"/>
    <!-- XXX we might want to get this back
             (and similarly for the next queries)
    <validation schema="xpath-1.0-core-basic.rnc" valid="yes"/>
    <validation schema="data-xpath.rnc" valid="yes"/>
    <validation schema="xpath-1.0-vertical-basic.rnc" valid="yes"/>
    <validation schema="xpath-1.0-downward-basic.rnc" valid="yes"/>
    -->
  </test>
  <test>
    <query>(self::b)[last()]</query>
    <validation schema="xpath-1.0-core-orig.rnc" valid="no"/>
    <validation schema="xpath-1.0-core-basic.rnc" valid="no"/>
    <validation schema="data-xpath.rnc" valid="no"/>
    <validation schema="xpath-1.0-vertical-basic.rnc" valid="no"/>
    <validation schema="xpath-1.0-downward-basic.rnc" valid="no"/>
  </test>
  <test>
    <query>descendant::a/self::b[last()]</query>
    <validation schema="xpath-1.0-core-orig.rnc" valid="no"/>
    <validation schema="xpath-1.0-core-basic.rnc" valid="no"/>
    <validation schema="data-xpath.rnc" valid="no"/>
    <validation schema="xpath-1.0-vertical-basic.rnc" valid="no"/>
    <validation schema="xpath-1.0-downward-basic.rnc" valid="no"/>
  </test>
  <test>
    <query>descendant::a/(self::b[last()])</query>
    <validation schema="xpath-1.0-core-orig.rnc" valid="no"/>
    <validation schema="xpath-1.0-core-basic.rnc" valid="no"/>
    <validation schema="data-xpath.rnc" valid="no"/>
    <validation schema="xpath-1.0-vertical-basic.rnc" valid="no"/>
    <validation schema="xpath-1.0-downward-basic.rnc" valid="no"/>
  </test>
  <test>
    <query>descendant::a/(self::b)[last()]</query>
    <validation schema="xpath-1.0-core-orig.rnc" valid="no"/>
    <validation schema="xpath-1.0-core-basic.rnc" valid="no"/>
    <validation schema="data-xpath.rnc" valid="no"/>
    <validation schema="xpath-1.0-vertical-basic.rnc" valid="no"/>
    <validation schema="xpath-1.0-downward-basic.rnc" valid="no"/>
  </test>
  <test>
    <query>(descendant::a/self::b)[last()]</query>
    <validation schema="xpath-1.0-core-orig.rnc" valid="no"/>
    <validation schema="xpath-1.0-core-basic.rnc" valid="no"/>
    <validation schema="data-xpath.rnc" valid="no"/>
    <validation schema="xpath-1.0-vertical-basic.rnc" valid="no"/>
    <validation schema="xpath-1.0-downward-basic.rnc" valid="no"/>
  </test>

  <!-- Same as above but for the downward fragment. -->
  <test>
    <query>descendant::a/self::*[last()]</query>
    <validation schema="xpath-1.0-downward-last.rnc" valid="yes"/>
  </test>
  <test>
    <query>descendant::a/(self::*)[last()]</query>
    <validation schema="xpath-1.0-downward-last.rnc" valid="yes"/>
  </test>
  <test>
    <query>descendant::a/(self::*[last()])</query>
    <validation schema="xpath-1.0-downward-last.rnc" valid="yes"/>
  </test>
  <test>
    <query>(descendant::a/self::*)[last()]</query>
    <validation schema="xpath-1.0-downward-last.rnc" valid="no"/>
  </test>

  <test>
    <query>descendant::*[last()]</query>

    <validation schema="xpath-1.0-core-orig.rnc" valid="no"/>
    <validation schema="xpath-1.0-core-basic.rnc" valid="no"/>
    <validation schema="xpath-1.0-core-join.rnc" valid="no"/>

    <validation schema="xpath-1.0-core-full.rnc" valid="yes"/>
    <validation schema="xpath-1.0-forward-last.rnc" valid="yes"/>

    <!-- other expected results, just to be sure -->

    <validation schema="xpath-1.0.rnc" valid="yes"/>
    <validation schema="xpath-2.0.rnc" valid="yes"/>
    <validation schema="xpath-3.0.rnc" valid="yes"/>

    <validation schema="xpath-2.0-core-orig.rnc" valid="yes"/>
    <validation schema="xpath-2.0-core-basic.rnc" valid="yes"/>
    <validation schema="xpath-2.0-core-join.rnc" valid="yes"/>

    <validation schema="data-xpath.rnc" valid="no"/>
    <validation schema="xpath-1.0-downward-last.rnc" valid="no"/>
    <validation schema="xpath-1.0-vertical-full.rnc" valid="no"/>

    <validation schema="xpath-non-mixing-orig.rnc" valid="yes"/>
    <validation schema="xpath-non-mixing-basic.rnc" valid="yes"/>
  </test>

  <test>
    <query>self::*[last()]</query>
    <comment>
      From issue #8: we could always allow this since it is equivalent to self::*.
      It is a corner case, and a useless one, so we may drop it though.
    </comment>
    <validation schema="xpath-1.0.rnc" valid="yes"/>
    <validation schema="xpath-2.0.rnc" valid="yes"/>
    <validation schema="xpath-3.0.rnc" valid="yes"/>

    <validation schema="xpath-1.0-core-full.rnc" valid="yes"/>
    <validation schema="xpath-2.0-core-join.rnc" valid="yes"/>

    <validation schema="data-xpath.rnc" valid="no"/>
    <validation schema="xpath-1.0-downward-last.rnc" valid="yes"/>
    <validation schema="xpath-1.0-forward-last.rnc" valid="yes"/>
    <validation schema="xpath-1.0-vertical-full.rnc" valid="yes"/>

    <validation schema="xpath-non-mixing-orig.rnc" valid="yes"/>
  </test>

  <test>
    <query>$x[last()]</query>
    <comment>
      From issue #8: we always allow last on a varref (cf. expr/last) which seems abusive.
      This query is discussed more specifically in issue #14.
    </comment>
    <validation schema="xpath-1.0.rnc" valid="yes"/>
    <validation schema="xpath-2.0.rnc" valid="yes"/>
    <validation schema="xpath-3.0.rnc" valid="yes"/>

    <validation schema="xpath-1.0-core-orig.rnc" valid="no"/>
    <validation schema="xpath-1.0-core-basic.rnc" valid="no"/>
    <validation schema="xpath-1.0-core-last.rnc" valid="no"/>
    <validation schema="xpath-1.0-core-join.rnc" valid="no"/>
    <validation schema="xpath-1.0-core-full.rnc" valid="yes"/>
    <validation schema="xpath-2.0-core-join.rnc" valid="yes"/>

    <validation schema="data-xpath.rnc" valid="no"/>
    <validation schema="xpath-1.0-downward-last.rnc" valid="no"/>
    <validation schema="xpath-1.0-forward-last.rnc" valid="no"/>
    <validation schema="xpath-1.0-vertical-full.rnc" valid="no"/>

    <validation schema="xpath-non-mixing-orig.rnc" valid="yes"/>
  </test>

  <test>
    <query>*[last()]</query>
    <comment>
      From issue #8: this could be accepted in the forward fragment.
    </comment>

    <validation schema="xpath-1.0.rnc" valid="yes"/>
    <validation schema="xpath-2.0.rnc" valid="yes"/>
    <validation schema="xpath-3.0.rnc" valid="yes"/>

    <validation schema="xpath-1.0-core-full.rnc" valid="yes"/>
    <validation schema="xpath-2.0-core-join.rnc" valid="yes"/>

    <validation schema="data-xpath.rnc" valid="no"/>
    <validation schema="xpath-1.0-forward-last.rnc" valid="yes"/>
    <validation schema="xpath-1.0-downward-last.rnc" valid="no"/>
    <validation schema="xpath-1.0-vertical-full.rnc" valid="no"/>

    <validation schema="xpath-non-mixing-orig.rnc" valid="yes"/>
  </test>

  <test>
    <query>*[self::ulink|self::doc:ulink][last()]/following-sibling::node()</query>

    <validation schema="xpath-1.0.rnc" valid="yes"/>
    <validation schema="xpath-2.0.rnc" valid="yes"/>
    <validation schema="xpath-3.0.rnc" valid="yes"/>

    <validation schema="xpath-1.0-core-full.rnc" valid="yes"/>
    <validation schema="xpath-2.0-core-join.rnc" valid="yes"/>

    <validation schema="data-xpath.rnc" valid="no"/>
    <validation schema="xpath-1.0-forward-last.rnc" valid="yes"/>
    <validation schema="xpath-1.0-downward-last.rnc" valid="no"/>
    <validation schema="xpath-1.0-vertical-full.rnc" valid="no"/>

    <validation schema="xpath-non-mixing-orig.rnc" valid="yes"/>
  </test>

  <!-- Variables -->

  <test>
    <query>.[$x=a[$y=b]]</query>
    <comment>
      In the downward fragment, only some uses of variables can be justified,
      essentially when the query is equi-satisfiable with a query where all
      uses of variables in paths are from the root.
      This query illustrates a case where we cannot reach such a form.
    </comment>

    <validation schema="xpath-1.0-downward-orig.rnc" valid="no"/>

    <validation schema="data-xpath.rnc" valid="no"/>
    <validation schema="xpath-1.0-vertical-orig.rnc" valid="no"/>
    <validation schema="xpath-1.0-vertical-basic.rnc" valid="yes"/>
    <validation schema="xpath-1.0-vertical-id.rnc" valid="yes"/>
    <validation schema="xpath-1.0-vertical-full.rnc" valid="yes"/>

    <validation schema="xpath-non-mixing-orig.rnc" valid="yes"/>

    <validation schema="xpath-1.0.rnc" valid="yes"/>
    <validation schema="xpath-1.0-core-orig.rnc" valid="no"/>
    <validation schema="xpath-1.0-core-basic.rnc" valid="no"/>
    <validation schema="xpath-1.0-core-join.rnc" valid="yes"/>
    <validation schema="xpath-1.0-core-full.rnc" valid="yes"/>
    <validation schema="xpath-2.0-core-orig.rnc" valid="no"/>
    <validation schema="xpath-2.0-core-join.rnc" valid="yes"/>
    <validation schema="xpath-2.0.rnc" valid="yes"/>
    <validation schema="xpath-3.0.rnc" valid="yes"/>
  </test>

  <test>
    <query>$x/$y</query>
    <validation schema="xpath-1.0-core-orig.rnc" valid="no"/>
    <validation schema="xpath-1.0-core-basic.rnc" valid="yes"/>
    <validation schema="xpath-1.0-core-join.rnc" valid="yes"/>
    <validation schema="xpath-1.0-core-full.rnc" valid="yes"/>
    <validation schema="xpath-2.0-core-orig.rnc" valid="yes"/>
    <validation schema="xpath-2.0-core-join.rnc" valid="yes"/>
  </test>

  <!-- Joins -->
  <test>
    <query>child::a[*/@b != parent::c] and not(child::b)</query>
    <validation schema="xpath-1.0-core-orig.rnc" valid="no"/>
    <validation schema="xpath-1.0-core-join.rnc" valid="yes"/>
    <validation schema="xpath-1.0-core-basic.rnc" valid="no"/>
    <validation schema="xpath-1.0-core-full.rnc" valid="yes"/>
    <validation schema="xpath-2.0-core-orig.rnc" valid="no"/>
    <validation schema="xpath-2.0-core-join.rnc" valid="yes"/>
  </test>
  <test>
    <query>not(.[@a=@b])</query>
    <validation schema="xpath-1.0-core-orig.rnc" valid="no"/>
    <validation schema="xpath-1.0-core-join.rnc" valid="no"/>
    <validation schema="xpath-1.0-core-basic.rnc" valid="no"/>
    <validation schema="xpath-1.0-core-full.rnc" valid="no"/>
    <validation schema="xpath-2.0-core-orig.rnc" valid="no"/>
    <validation schema="xpath-2.0-core-join.rnc" valid="no"/>
  </test>
  <test>
    <query>child::a[@a=@b][last()]</query>
    <!-- last and join don't combine well here: our encoding
         of last would introduce a negation of the join -->
    <validation schema="xpath-1.0-core-orig.rnc" valid="no"/>
    <validation schema="xpath-1.0-core-join.rnc" valid="no"/>
    <validation schema="xpath-1.0-core-basic.rnc" valid="no"/>
    <validation schema="xpath-1.0-core-last.rnc" valid="no"/>
    <validation schema="xpath-1.0-core-full.rnc" valid="no"/>
    <validation schema="xpath-2.0-core-orig.rnc" valid="no"/>
    <validation schema="xpath-2.0-core-join.rnc" valid="no"/>
  </test>
  <test>
    <query>(child::a[@a=@b])[last()]</query>
    <!-- same as above -->
    <validation schema="xpath-1.0-core-orig.rnc" valid="no"/>
    <validation schema="xpath-1.0-core-join.rnc" valid="no"/>
    <validation schema="xpath-1.0-core-basic.rnc" valid="no"/>
    <validation schema="xpath-1.0-core-last.rnc" valid="no"/>
    <validation schema="xpath-1.0-core-full.rnc" valid="no"/>
    <validation schema="xpath-2.0-core-orig.rnc" valid="no"/>
    <validation schema="xpath-2.0-core-join.rnc" valid="no"/>
  </test>
  <test>
    <query>child::a[last()][@a=@b]</query>
    <!-- here the two encodings can be combined,
         so we may accept the query in 1.0-core-full -->
    <validation schema="xpath-1.0-core-orig.rnc" valid="no"/>
    <validation schema="xpath-1.0-core-join.rnc" valid="no"/>
    <validation schema="xpath-1.0-core-basic.rnc" valid="no"/>
    <validation schema="xpath-1.0-core-last.rnc" valid="no"/>
    <validation schema="xpath-1.0-core-full.rnc" valid="yes"/>
    <validation schema="xpath-2.0-core-orig.rnc" valid="no"/>
    <validation schema="xpath-2.0-core-join.rnc" valid="yes"/>
  </test>
  <test>
    <query>child::a[@a=@b and position()=last()]</query>
    <!-- this is equivalent to the previous query
         (though the AST differs quite a bit)
         so we may also accept it -->
    <validation schema="xpath-1.0-core-orig.rnc" valid="no"/>
    <validation schema="xpath-1.0-core-join.rnc" valid="no"/>
    <validation schema="xpath-1.0-core-basic.rnc" valid="no"/>
    <validation schema="xpath-1.0-core-last.rnc" valid="no"/>
    <validation schema="xpath-1.0-core-full.rnc" valid="yes"/>
    <validation schema="xpath-2.0-core-orig.rnc" valid="no"/>
    <validation schema="xpath-2.0-core-join.rnc" valid="yes"/>
  </test>
  <test>
    <query>(child::a[last()])[@a=@b]</query>
    <!-- same as above, with yet another AST -->
    <validation schema="xpath-1.0-core-orig.rnc" valid="no"/>
    <validation schema="xpath-1.0-core-join.rnc" valid="no"/>
    <validation schema="xpath-1.0-core-basic.rnc" valid="no"/>
    <validation schema="xpath-1.0-core-last.rnc" valid="no"/>
    <validation schema="xpath-1.0-core-full.rnc" valid="yes"/>
    <validation schema="xpath-2.0-core-orig.rnc" valid="no"/>
    <validation schema="xpath-2.0-core-join.rnc" valid="yes"/>
  </test>
  <test>
    <query>child::a[@a=@b]/ancestor::b[last()]</query>
    <validation schema="xpath-1.0-core-orig.rnc" valid="no"/>
    <validation schema="xpath-1.0-core-join.rnc" valid="no"/>
    <validation schema="xpath-1.0-core-basic.rnc" valid="no"/>
    <validation schema="xpath-1.0-core-last.rnc" valid="no"/>
    <validation schema="xpath-1.0-core-full.rnc" valid="yes"/>
    <validation schema="xpath-2.0-core-orig.rnc" valid="no"/>
    <validation schema="xpath-2.0-core-join.rnc" valid="yes"/>
  </test>
  <test>
    <query>child::a[@a=@b]/(ancestor::b[last()])</query>
    <validation schema="xpath-1.0-core-orig.rnc" valid="no"/>
    <validation schema="xpath-1.0-core-join.rnc" valid="no"/>
    <validation schema="xpath-1.0-core-basic.rnc" valid="no"/>
    <validation schema="xpath-1.0-core-last.rnc" valid="no"/>
    <validation schema="xpath-1.0-core-full.rnc" valid="yes"/>
    <validation schema="xpath-2.0-core-orig.rnc" valid="no"/>
    <validation schema="xpath-2.0-core-join.rnc" valid="yes"/>
  </test>
  <test>
    <query>$x[@a=@b]</query>
    <validation schema="xpath-1.0-core-orig.rnc" valid="no"/>
    <validation schema="xpath-1.0-core-join.rnc" valid="no"/>
    <validation schema="xpath-1.0-core-basic.rnc" valid="no"/>
    <validation schema="xpath-1.0-core-last.rnc" valid="no"/>
    <validation schema="xpath-1.0-core-full.rnc" valid="yes"/>
    <validation schema="xpath-2.0-core-orig.rnc" valid="no"/>
    <validation schema="xpath-2.0-core-join.rnc" valid="yes"/>
  </test>
  <test>
    <query>$y/$x[@a=@b]/$z[not(child::a)]</query>
    <validation schema="xpath-1.0-core-orig.rnc" valid="no"/>
    <validation schema="xpath-1.0-core-join.rnc" valid="no"/>
    <validation schema="xpath-1.0-core-basic.rnc" valid="no"/>
    <validation schema="xpath-1.0-core-last.rnc" valid="no"/>
    <validation schema="xpath-1.0-core-full.rnc" valid="yes"/>
    <validation schema="xpath-2.0-core-orig.rnc" valid="no"/>
    <validation schema="xpath-2.0-core-join.rnc" valid="yes"/>
  </test>

  <!-- Testing core-2.0-core-join -->
  <test>
    <query>some $x in *[@a=@b] satisfies child::c = @d</query>
    <validation schema="xpath-2.0-core-orig.rnc" valid="no"/>
    <validation schema="xpath-2.0-core-join.rnc" valid="yes"/>
  </test>
  <test>
    <query>every $x in *[@a=@b] satisfies child::c</query>
    <validation schema="xpath-2.0-core-orig.rnc" valid="no"/>
    <validation schema="xpath-2.0-core-join.rnc" valid="no"/>
  </test>
  <test>
    <query>every $x in *[@a=@b] satisfies child::c = @d</query>
    <validation schema="xpath-2.0-core-orig.rnc" valid="no"/>
    <validation schema="xpath-2.0-core-join.rnc" valid="no"/>
  </test>
  <test>
    <query>child::a[child::b = .] intersect child::b[child::a = .]</query>
    <validation schema="xpath-2.0-core-orig.rnc" valid="no"/>
    <validation schema="xpath-2.0-core-join.rnc" valid="yes"/>
  </test>
  <test>
    <query>child::a[child::b = .] except child::b</query>
    <validation schema="xpath-2.0-core-orig.rnc" valid="no"/>
    <validation schema="xpath-2.0-core-join.rnc" valid="yes"/>
  </test>
  <test>
    <query>child::a except child::b[child::b = .]</query>
    <validation schema="xpath-2.0-core-orig.rnc" valid="no"/>
    <validation schema="xpath-2.0-core-join.rnc" valid="no"/>
  </test>
  <test>
    <query>for $x in *[@a=.] return $x/child::a</query>
    <validation schema="xpath-2.0-core-orig.rnc" valid="no"/>
    <validation schema="xpath-2.0-core-join.rnc" valid="no"/>
  </test>
  <test>
    <query>for $x in * return $x/child::a[@a=.]</query>
    <validation schema="xpath-2.0-core-orig.rnc" valid="no"/>
    <validation schema="xpath-2.0-core-join.rnc" valid="no"/>
  </test>
  <test>
    <query>for $x in * return $x/child::a</query>
    <validation schema="xpath-2.0-core-orig.rnc" valid="yes"/>
    <validation schema="xpath-2.0-core-join.rnc" valid="yes"/>
  </test>

  <!-- id -->
  <test>
    <query>child::a[id(child::b)]</query>
    <validation schema="xpath-1.0-vertical-id.rnc" valid="no" />
  </test>
  <test>
    <query>id(child::a)[child::b]</query>
    <validation schema="xpath-1.0-vertical-id.rnc" valid="no" />
  </test>
  <test>
    <query>child::a[//id(child::b)]</query>
    <validation schema="xpath-1.0-vertical-id.rnc" valid="yes" />
  </test>
  <test>
    <query>child::a[root()/id(child::b)]</query>
    <validation schema="xpath-1.0-vertical-id.rnc" valid="yes" />
  </test>
  <test>
    <query>//child::a[id(child::b)]</query>
    <validation schema="xpath-1.0-vertical-id.rnc" valid="no" />
  </test>
  <test>
    <query>//id(child::a)[child::b]</query>
    <validation schema="xpath-1.0-vertical-id.rnc" valid="yes" />
  </test>

  <!-- constants -->
  <test>
    <query>1 eq foo/@bar</query>

    <validation schema="xpath-1.0-core-basic.rnc" valid="yes"/>
    <validation schema="xpath-1.0-downward-basic.rnc" valid="yes"/>
    <validation schema="xpath-1.0-forward-basic.rnc" valid="yes"/>
    <validation schema="xpath-1.0-vertical-basic.rnc" valid="yes"/>
    <validation schema="xpath-2.0-core-basic.rnc" valid="yes"/>
    <validation schema="xpath-emso2-basic.rnc" valid="yes"/>
    <validation schema="xpath-non-mixing-basic.rnc" valid="yes"/>

    <validation schema="xpath-1.0-core-orig.rnc" valid="no"/>
    <validation schema="xpath-1.0-downward-orig.rnc" valid="no"/>
    <validation schema="xpath-1.0-forward-orig.rnc" valid="no"/>
    <validation schema="xpath-1.0-vertical-orig.rnc" valid="no"/>
    <validation schema="xpath-2.0-core-orig.rnc" valid="no"/>
    <validation schema="xpath-emso2-orig.rnc" valid="no"/>
    <validation schema="xpath-non-mixing-orig.rnc" valid="yes"/>
  </test>

  <test>
    <query>1 = foo/@bar</query>

    <validation schema="xpath-1.0-core-basic.rnc" valid="yes"/>
    <validation schema="xpath-1.0-downward-basic.rnc" valid="yes"/>
    <validation schema="xpath-1.0-forward-basic.rnc" valid="yes"/>
    <validation schema="xpath-1.0-vertical-basic.rnc" valid="yes"/>
    <validation schema="xpath-2.0-core-basic.rnc" valid="yes"/>
    <validation schema="xpath-emso2-basic.rnc" valid="yes"/>
    <validation schema="xpath-non-mixing-basic.rnc" valid="yes"/>

    <validation schema="xpath-1.0-core-orig.rnc" valid="no"/>
    <validation schema="xpath-1.0-downward-orig.rnc" valid="no"/>
    <validation schema="xpath-1.0-forward-orig.rnc" valid="no"/>
    <validation schema="xpath-1.0-vertical-orig.rnc" valid="no"/>
    <validation schema="xpath-2.0-core-orig.rnc" valid="no"/>
    <validation schema="xpath-emso2-orig.rnc" valid="no"/>
    <validation schema="xpath-non-mixing-orig.rnc" valid="yes"/>
  </test>

  <test>
    <query>1 ne foo/@bar</query>

    <validation schema="xpath-1.0-core-basic.rnc" valid="yes"/>
    <validation schema="xpath-1.0-downward-basic.rnc" valid="yes"/>
    <validation schema="xpath-1.0-forward-basic.rnc" valid="yes"/>
    <validation schema="xpath-1.0-vertical-basic.rnc" valid="yes"/>
    <validation schema="xpath-2.0-core-basic.rnc" valid="yes"/>
    <validation schema="xpath-emso2-basic.rnc" valid="yes"/>
    <validation schema="xpath-non-mixing-basic.rnc" valid="yes"/>

    <validation schema="xpath-1.0-core-orig.rnc" valid="no"/>
    <validation schema="xpath-1.0-downward-orig.rnc" valid="no"/>
    <validation schema="xpath-1.0-forward-orig.rnc" valid="no"/>
    <validation schema="xpath-1.0-vertical-orig.rnc" valid="no"/>
    <validation schema="xpath-2.0-core-orig.rnc" valid="no"/>
    <validation schema="xpath-emso2-orig.rnc" valid="no"/>
    <validation schema="xpath-non-mixing-orig.rnc" valid="yes"/>
  </test>

  <test>
    <query>1 lt foo/@bar</query>

    <validation schema="xpath-1.0-core-basic.rnc" valid="yes"/>
    <validation schema="xpath-1.0-downward-basic.rnc" valid="yes"/>
    <validation schema="xpath-1.0-forward-basic.rnc" valid="yes"/>
    <validation schema="xpath-1.0-vertical-basic.rnc" valid="yes"/>
    <validation schema="xpath-2.0-core-basic.rnc" valid="yes"/>
    <validation schema="xpath-emso2-basic.rnc" valid="yes"/>
    <validation schema="xpath-non-mixing-basic.rnc" valid="yes"/> <!-- ??? -->

    <validation schema="xpath-1.0-core-orig.rnc" valid="no"/>
    <validation schema="xpath-1.0-downward-orig.rnc" valid="no"/>
    <validation schema="xpath-1.0-forward-orig.rnc" valid="no"/>
    <validation schema="xpath-1.0-vertical-orig.rnc" valid="no"/>
    <validation schema="xpath-2.0-core-orig.rnc" valid="no"/>
    <validation schema="xpath-emso2-orig.rnc" valid="no"/>
    <validation schema="xpath-non-mixing-orig.rnc" valid="no"/>
  </test>

  <test>
    <query>1+1 = foo/@bar</query>

    <validation schema="xpath-1.0-core-basic.rnc" valid="yes"/>
    <validation schema="xpath-1.0-downward-basic.rnc" valid="yes"/>
    <validation schema="xpath-1.0-forward-basic.rnc" valid="yes"/>
    <validation schema="xpath-1.0-vertical-basic.rnc" valid="yes"/>
    <validation schema="xpath-2.0-core-basic.rnc" valid="yes"/>
    <validation schema="xpath-emso2-basic.rnc" valid="yes"/>
    <validation schema="xpath-non-mixing-basic.rnc" valid="yes"/>

    <validation schema="xpath-1.0-core-orig.rnc" valid="no"/>
    <validation schema="xpath-1.0-downward-orig.rnc" valid="no"/>
    <validation schema="xpath-1.0-forward-orig.rnc" valid="no"/>
    <validation schema="xpath-1.0-vertical-orig.rnc" valid="no"/>
    <validation schema="xpath-2.0-core-orig.rnc" valid="no"/>
    <validation schema="xpath-emso2-orig.rnc" valid="no"/>
    <validation schema="xpath-non-mixing-orig.rnc" valid="yes"/>
  </test>

  <test>
    <query>not("foo" = bar)</query>

    <validation schema="xpath-1.0-core-orig.rnc" valid="no"/>
    <validation schema="xpath-1.0-downward-orig.rnc" valid="no"/>
    <validation schema="xpath-1.0-forward-orig.rnc" valid="no"/>
    <validation schema="xpath-1.0-vertical-orig.rnc" valid="no"/>
    <validation schema="xpath-2.0-core-orig.rnc" valid="no"/>
    <validation schema="xpath-emso2-orig.rnc" valid="no"/>
    <validation schema="xpath-non-mixing-orig.rnc" valid="no"/>

    <validation schema="xpath-1.0-core-basic.rnc" valid="yes"/>
    <validation schema="xpath-1.0-downward-basic.rnc" valid="yes"/>
    <validation schema="xpath-1.0-forward-basic.rnc" valid="yes"/>
    <validation schema="xpath-1.0-vertical-basic.rnc" valid="yes"/>
    <validation schema="xpath-2.0-core-basic.rnc" valid="yes"/>
    <validation schema="xpath-emso2-basic.rnc" valid="yes"/>
    <validation schema="xpath-non-mixing-basic.rnc" valid="no"/>
  </test>

</tests>
